---
# Test file for selenium
- hosts: all
  vars:
    selenium_install_firefox: yes

  pre_tasks:
    - name: Update apt cache (if distro is debian based)
      apt: update_cache=yes
      when: ansible_os_family == 'Debian'
      tags: [pre]

  post_tasks:
    - name: Check firefox install
      shell: firefox --version
      changed_when: False
      tags: [post]

    - name: Install wget
      package: name=wget state=present

    - name: Test selenium server response
      shell: wget -qO - http://localhost:4444/wd/hub/status > /dev/null
      changed_when: False
      tags: [post]

    - name: Test restart selenium server for sysv
      shell: /etc/init.d/selenium restart
      when: selenium_system_manager.stdout == 'sysv'
      changed_when: False
      tags: [post]

    - name: Test restart selenium server for systemd
      service: name=selenium state=restarted
      when: selenium_system_manager.stdout == 'systemd'
      changed_when: False
      tags: [post]

    - name: Waiting for selenium server to be available
      wait_for: port=4444 delay=2 timeout=60
      tags: [configuration, selenium, selenium-run]

    - name: Test selenium server response
      shell: wget -qO - http://localhost:4444/wd/hub/status > /dev/null
      changed_when: False
      tags: [post]

  roles:
    - role_under_test